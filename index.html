<html>
<head>
    <base href="https://sethispr.github.io/fos">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="sa op calc test">
    <meta name="keywords" content="silent assassin roblox">
    <meta name="author" content="sethispr">
    <meta property="og:title" content="fos">
    <meta property="og:description" content="sa op calc test">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://sethispr.github.io/fos/">
    <meta property="og:image" content="https://sethispr.github.io/fos/assets/izzi.ico">
    <meta name="theme-color" content="#000000">
    <link rel="canonical" href="https://sethispr.github.io/fos/">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <title>fos</title>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@300;400;500;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@300;400;500;700&display=swap">
    </noscript>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" media="print" onload="this.media='all'">
    <noscript>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    </noscript>
    <link rel="icon" href="https://sethispr.github.io/fos/assets/izzi.ico">
</head>
    
<style>.container,body{padding:20px;background:#000}*,body{scrollbar-width:thin;scrollbar-color:#0c0c0c #000000}.container,body,button{background:#000}body,button{color:#dcddde}.result-header button,button{font-family:'Lexend Deca',sans-serif;text-transform:uppercase;transition:.2s ease-in-out;cursor:pointer}#scrollUpButton,.container{box-shadow:8px 8px 15px rgba(0,0,0,.6),-8px -8px 15px rgba(12,12,12,.1)}#tooltip,.result-label[data-tooltip]::after{background-color:rgba(0,0,0,.85);padding:5px 10px;pointer-events:none;transition:opacity .3s;white-space:nowrap}body{font-family:'Lexend Deca',sans-serif;margin:0;font-size:16px;min-height:100vh;display:flex;align-items:center;justify-content:center;overflow-y:auto}.container{width:95%;max-width:100%;resize:vertical;overflow:visible;min-width:300px;min-height:400px;transition:.3s;position:relative;backdrop-filter:blur(10px);border:1px solid rgba(26,26,26,.2);border-radius:20px;margin:auto;animation:.5s ease-out fadeIn}.calculator-section,.results-section{resize:none;min-height:200px;overflow:visible}.container::-webkit-scrollbar,.container::-webkit-scrollbar-thumb,.container::-webkit-scrollbar-track{display:none}::-webkit-scrollbar{width:12px;height:12px}::-webkit-scrollbar-track{background:#000;border-radius:8px}::-webkit-scrollbar-thumb{background:#0c0c0c;border-radius:8px;border:2px solid #000;transition:background .3s}.results-section,button{border:1px solid #1a1a1a}::-webkit-scrollbar-thumb:hover{background:#1a1a1a}button{padding:10px 18px;font-size:.95rem;font-weight:600;border-radius:8px}.result-header button:hover,button:hover{background:#0c0c0c;box-shadow:none}.button-group{display:flex;gap:10px;justify-content:flex-end;margin-bottom:15px;flex-wrap:wrap}.calculator-section{margin:20px 0;transition:.3s}.calculator-grid{display:grid;grid-template-columns:1fr;gap:15px;padding:15px;transition:.3s}.input-group{display:flex;flex-direction:column;gap:5px}.input-group label{color:#72767d;font-size:.92rem;font-weight:600}.input-group input[type=number]{font-size:1rem;padding:10px;background:rgba(0,0,0,.3);color:#dcddde;border:1px solid rgba(26,26,26,.4);opacity:.7;transition:.3s;border-radius:8px;text-align:center;font-weight:700;backdrop-filter:blur(4px)}.input-group input[type=number]:focus,.input-group input[type=number]:hover{opacity:1;background:rgba(12,12,12,.5);border-color:rgba(38,38,38,.6);outline:0;box-shadow:0 0 15px rgba(0,0,0,.2);font-weight:700}.input-group input[type=checkbox]{width:20px;height:20px;accent-color:#dcddde;cursor:pointer}.toggle-switch{position:relative;display:inline-block;width:60px;height:30px}.toggle-switch input{opacity:0;width:0;height:0}.toggle-slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#1a1a1a;transition:.3s;border-radius:30px;border:1px solid #262626}.toggle-slider:before{position:absolute;content:"";height:22px;width:22px;left:4px;bottom:3px;background-color:#dcddde;transition:.3s;border-radius:50%}input:checked+.toggle-slider{background-color:#0c0c0c}input:checked+.toggle-slider:before{transform:translateX(30px)}.input-group.toggle-group{flex-direction:row;align-items:center;justify-content:space-between;gap:10px}.results-section{min-width:250px;transition:.3s;backdrop-filter:blur(8px);background:#000;padding:20px;border-radius:16px;margin-top:20px}.result-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.results-section .result-header h4,.stats-header h4{margin:0;color:#72767d;font-weight:400}.result-header button{padding:8px 12px;font-size:.85rem;background:#000;color:#dcddde;border:1px solid #1a1a1a;font-weight:600;border-radius:8px}.result-item{display:flex;justify-content:space-between;padding:15px;margin:5px 0;border-radius:10px;background:rgba(0,0,0,.2);transition:.3s}.device-option,.stat-line{padding:12px;transition:.3s;opacity:.7}.result-item:hover{background:rgba(12,12,12,.4);transform:translateX(5px)}.result-item:last-child{border-bottom:none}.result-label{color:#72767d;position:relative;cursor:pointer}.result-label[data-tooltip]::after{content:attr(data-tooltip);position:absolute;color:#dcddde;border-radius:5px;font-size:14px;top:100%;left:50%;transform:translateX(-50%);opacity:0;z-index:100;margin-top:5px}.result-label:hover::after{opacity:1}.result-value{color:#72767d;font-weight:600}.stat-line{margin-bottom:12px;border-radius:12px;background:#000;border:1px solid #1a1a1a;position:relative;overflow:visible}.stat-line:hover{opacity:1;background:#0c0c0c;border-color:#262626;box-shadow:inset 0 1px 3px rgba(0,0,0,.2),0 0 0 1px #262626}.stat-value{font-weight:600;outline:0;border:none;background:0 0;transition:.3s;color:#dcddde;cursor:text;min-width:20px;display:inline-block}.stat-value:focus{outline:0;box-shadow:none}.stat-line:focus-within{opacity:1;background:#0c0c0c;border-color:#262626;box-shadow:inset 0 1px 3px rgba(0,0,0,.2),0 0 0 1px #262626}.device-selection{margin-top:30px;margin-bottom:20px}.formatted-output,.graphs-section{margin-top:20px}.device-options{display:flex;gap:10px;flex-wrap:wrap}.device-option{flex:1;min-width:100px;background:#000;border:1px solid #1a1a1a;border-radius:8px;cursor:pointer;backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;gap:8px}.device-option.selected,.device-option:hover{background:#0c0c0c;border-color:#262626;transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,0,0,.2)}.device-option.selected{opacity:1;background:#0c0c0c;border:1px solid #262626;box-shadow:inset 0 2px 4px rgba(0,0,0,.3);transform:translateY(1px)}.device-label{display:flex;align-items:center;justify-content:center;gap:8px;color:#72767d}.device-label i{font-size:1.2em;color:#888}#tooltip,.error-popup .close-error i,.tutorial-box button{font-size:14px}.stats-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}.formatted-output #formattedStats{white-space:pre-line;word-wrap:break-word;color:#72767d}.tutorial-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.8);z-index:1000;display:none}.tutorial-box{position:fixed;background:#000;border:1px solid #1a1a1a;border-radius:12px 0;padding:20px;color:#dcddde;max-width:300px;box-shadow:0 4px 15px rgba(0,0,0,.3);z-index:1001;animation:.3s ease-out tutorialFadeIn;transition:.3s cubic-bezier(.4, 0, .2, 1)}.error-popup,.error-popup .close-error:hover,.tutorial-box button:hover{background:#1a1a1a}@keyframes tutorialFadeIn{0%{opacity:0;transform:scale(.95) translateY(10px)}100%{opacity:1;transform:scale(1) translateY(0)}}.tutorial-box.pointing-down::after,.tutorial-box.pointing-left::after,.tutorial-box.pointing-right::after,.tutorial-box.pointing-up::after{display:none}.highlight-element{position:relative;z-index:1002;box-shadow:0 0 0 2px #dcddde;border-radius:8px}#scrollUpButton,.error-popup{position:fixed;opacity:0;visibility:hidden}.tutorial-box button{padding:8px 12px;border:none;background:#0c0c0c;color:#dcddde;border-radius:6px;cursor:pointer;transition:.2s}.tutorial-box .tutorial-complete,.tutorial-box .tutorial-next,.tutorial-box .tutorial-prev{width:36px;height:36px;padding:0;display:flex;align-items:center;justify-content:center}.tutorial-box .tutorial-skip{font-size:14px;padding:0 12px}.tutorial-box i{font-size:16px}.error-popup{top:50%;left:50%;transform:translate(-50%,-50%) scale(.9);color:#dcddde;padding:20px 30px;border:1px solid #262626;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,.5);z-index:999;transition:opacity .3s,transform .3s,visibility .3s;min-width:300px;max-width:90vw}.error-popup.active{opacity:1;visibility:visible;transform:translate(-50%,-50%) scale(1)}.error-popup .error-content{display:flex;align-items:center;gap:15px}.error-popup .error-icon{font-size:24px;color:#ff4d4d}.error-popup .error-message{flex:1}.error-popup .close-error{background:#0c0c0c;border:none;color:#dcddde;font-size:16px;cursor:pointer;padding:8px 12px;border-radius:6px;display:flex;align-items:center;gap:8px;transition:background .2s}#scrollUpButton{bottom:30px;right:30px;width:50px;height:50px;background:#000;border:1px solid #1a1a1a;border-radius:50%;transition:opacity .3s,visibility .3s,transform .3s;z-index:9999;backdrop-filter:blur(4px);cursor:pointer;display:flex;align-items:center;justify-content:center}#scrollUpButton.show{opacity:1;visibility:visible;transform:translateY(0)}#scrollUpButton.hide{opacity:0;visibility:hidden;transform:translateY(20px)}#scrollUpButton:hover{background:#0c0c0c;transform:translateY(0) scale(1.1);box-shadow:10px 10px 20px rgba(0,0,0,.6),-10px -10px 20px rgba(12,12,12,.1)}#scrollUpButton svg{width:20px;height:20px;fill:none;stroke:#dcddde;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}.graphs-section{display:none;opacity:0;transition:opacity .3s ease-in-out;padding:20px;border-radius:16px}.graphs-section.show{display:block;opacity:1}.graphs-section canvas{width:100%;max-width:600px;margin:0 auto;display:block}#tooltip{position:absolute;color:#dcddde;border-radius:5px;opacity:0;z-index:10000}@media (min-width:769px){.calculator-grid{grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:20px;padding:20px}.button-group{gap:15px}.input-group input[type=number]{padding:12px}.graphs-section canvas{max-width:600px}}@media (max-width:480px){body{font-size:14px}.input-group input[type=number]{font-size:.85rem}.calculator-grid{gap:10px}.device-option{min-width:80px;padding:10px}.tutorial-box{max-width:90%;padding:15px}.tutorial-box .tutorial-skip{padding:0 8px}.result-item{flex-direction:column;align-items:flex-start}.result-value{margin-top:5px}.button-group{flex-direction:column;align-items:stretch}}.graphs-section{background:#000;border:none;box-shadow:none}html{scroll-behavior:smooth}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.device-option:focus{outline:#262626 solid 2px;outline-offset:2px}input:focus{outline:#262626 solid 2px;outline-offset:0</style>
    <!-- Chart.js for Graphs -->
    <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <div class="button-group">
            <button id="resetButton"><i class="fas fa-redo"></i> Reset</button>
            <button id="showTutorial"><i class="fas fa-question-circle"></i> Tutorial</button>
            <button id="copyButton"><i class="fas fa-copy"></i> Copy</button>
        </div>
        <div id="output" contenteditable="false"></div>
        <div class="calculator-section">
            <div class="calculator-grid">
                <div class="input-group">
                    <label for="l_va">Level A</label>
                    <input type="number" id="l_va" placeholder="Lvl A" min="0" step="1">
                </div>
                <div class="input-group">
                    <label for="X_pa">XP A</label>
                    <input type="number" id="X_pa" placeholder="XP A" min="0" step="1">
                </div>
                <div class="input-group">
                    <label for="l_vb">Level B</label>
                    <input type="number" id="l_vb" placeholder="Lvl B" min="0" step="1">
                </div>
                <div class="input-group">
                    <label for="X_pb">XP B</label>
                    <input type="number" id="X_pb" placeholder="XP B" min="0" step="1">
                </div>
                <div class="input-group">
                    <label for="sdi">SDI</label>
                    <input type="number" id="sdi" value="1" step="0.1" min="0">
                </div>
                <div class="input-group toggle-group">
                    <label for="auto_penalty">Apply Round Penalty</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="auto_penalty" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
            <div class="results-section">
                <div class="result-header">
                    <h4>Performance Stats</h4>
                    <button id="toggleGraphButton"><i class="fas fa-chart-pie"></i> Show Graph</button>
                </div>
                <div class="result-item">
                    <span class="result-label" data-tooltip="OP = 529 / 20 * âˆš(TP + SP)">Overall Performance (OP)</span>
                    <span class="result-value" id="op_result">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label" data-tooltip="TP = (2 * R_ad * (86 * GO + S_mb * 32 * AD) + S_di * 59 * XPR * R_ad) / (165 * R_ad)">Tactical Performance (TP)</span>
                    <span class="result-value" id="tp_result">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label" data-tooltip="SP = (13 / R_ad) * (S_mb * (9 * F + 15 * i + 40 * w + 25 * I + 100 * e_p) + S_ma * 15 * s)">Special Performance (SP)</span>
                    <span class="result-value" id="sp_result">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label" data-tooltip="R_g = max(0, R_ad - E - t - e_p - s - w)">Guard Rounds (R_g)</span>
                    <span class="result-value" id="rg_result">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label" data-tooltip="GO = 46 * ((S_di * 5 * S + S_ma * 3 * P) / max(1, R_g))">Guard Objective Score (GO)</span>
                    <span class="result-value" id="gos_result">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label" data-tooltip="AD = D / max(1, (R_ad - (E + t + e_p)))">Average Damage (AD)</span>
                    <span class="result-value" id="ad_result">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label" data-tooltip="XPR = X_T / max(1, R_ad)">XP per Round (XPR)</span>
                    <span class="result-value" id="xpr_result">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label" data-tooltip="Indicates whether the round penalty was applied based on your stats">Round Penalty Applied</span>
                    <span class="result-value" id="round_penalty_applied">No</span>
                </div>
                <div class="result-item">
                    <span class="result-label" data-tooltip="Amount of rounds penalty applied">Round Penalty (Rp)</span>
                    <span class="result-value" id="round_penalty_value">-</span>
                </div>
                <!-- Graphs Section -->
                <div class="graphs-section">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>
            <div id="additionalSection" class="calculator-section">
                <div class="device-selection" style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 10px;">Primary Gaming Device</label>
                    <div class="device-options">
                        <button class="device-option" data-value="pc" tabindex="0">
                            <i class="fas fa-desktop"></i> PC/Laptop
                        </button>
                        <button class="device-option" data-value="mobile" tabindex="0">
                            <i class="fas fa-mobile-alt"></i> Mobile
                        </button>
                        <button class="device-option" data-value="tablet" tabindex="0">
                            <i class="fas fa-tablet-alt"></i> Tablet
                        </button>
                        <button class="device-option" data-value="console" tabindex="0">
                            <i class="fas fa-gamepad"></i> Console
                        </button>
                    </div>
                </div>
                <div class="formatted-output">
                    <div class="stats-header">
                        <h4>Stats Summary</h4>
                        <button id="copyFormatted"><i class="fas fa-copy"></i> Copy</button>
                    </div>
                    <div id="formattedStats"></div>
                </div>
            </div>
            <div class="github-link" style="display: none;"></div>
        </div>
        <!-- Scroll Up Button -->
        <button id="scrollUpButton" aria-label="Scroll to top">
            <svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <polyline points="5 12 10 7 15 12" />
                <line x1="10" y1="7" x2="10" y2="17" />
            </svg>
        </button>
        <!-- Error Popup -->
        <div class="error-popup" id="errorPopup">
            <div class="error-content">
                <i class="fas fa-exclamation-triangle error-icon"></i>
                <div class="error-message" id="errorMessage">An error has occurred.</div>
                <button class="close-error" id="closeError"><i class="fas fa-keyboard"></i> ESC</button>
            </div>
        </div>
        <!-- Tooltip -->
        <div id="tooltip"></div>
    </div>
    <script>
const FIXED_LABELS=["Rounds played","Targets assassinated","Escapes","Targets protected","Damage dealt","Final shots","Target survivals","Free for all kills","Free for all wins","Infecteds killed","Infection survivals","Infections","Epidemics"];let currentScreenshot="A",screenshotAData={},screenshotBData={};const copyButton=document.getElementById("copyButton"),resetButton=document.getElementById("resetButton"),output=document.getElementById("output"),errorPopup=document.getElementById("errorPopup"),errorMessage=document.getElementById("errorMessage"),closeError=document.getElementById("closeError"),scrollUpButton=document.getElementById("scrollUpButton"),tooltip=document.getElementById("tooltip"),toggleGraphButton=document.getElementById("toggleGraphButton"),autoPenaltyCheckbox=document.getElementById("auto_penalty");let performanceChart,graphVisible=!1;function calculateXPSum(e){let t=0;for(let r=1;r<=e;r++)t+=10*Math.floor((r-1)*(2.46*Math.pow(1.02,r))*10);return t}function calculateOP(){try{let e=(e,t,r=3)=>{let l=document.getElementById(e);try{if(isNaN(t)||!isFinite(t)){l.textContent="-";return}l.textContent=0===r?Math.round(t):t.toFixed(r),l.classList.remove("error"),l.removeAttribute("title")}catch(a){l.textContent="-",l.classList.add("error"),l.setAttribute("title",a.message),showErrorPopup("Calculation error: "+a.message)}},t=parseFloat(document.getElementById("l_va").value)||0,r=parseFloat(document.getElementById("X_pa").value)||0,l=parseFloat(document.getElementById("l_vb").value)||0,a=parseFloat(document.getElementById("X_pb").value)||0,o=parseFloat(document.getElementById("sdi").value)||1,s=autoPenaltyCheckbox.checked,n={};document.querySelectorAll("#output .stat-line").forEach(e=>{let t=e.querySelector(".stat-label").textContent,r=parseInt(e.querySelector(".stat-value").textContent)||0;n[t]=r});let i=n["Rounds played"]||0,c=n["Targets assassinated"]||0,u=n["Target survivals"]||0,d=!1,p=i;if(s&&i>0){let h=(c+u)/i<.12;h&&(p=i+3*(.12*i-(c+u)),p=Math.floor(p),d=!0)}document.getElementById("round_penalty_applied").textContent=d?"Yes":"No",document.getElementById("round_penalty_value").textContent=d?p:"-",d&&(i=p);let g=n.Escapes||0,m=i-g,v=n["Infection survivals"]||0,y=n["Free for all wins"]||0,f=n.Epidemics||0,E=Math.max(0,m-g-u-f-v-y),b=o<1?1+(2/3*(o-1)+1)-1:2/3*(o-1)+1,$=o<1?1+(4/3*(o-1)+1)-1:4/3*(o-1)+1,x=n["Final shots"]||0,S=n["Targets protected"]||0,_=46*((5*o*x+3*b*S)/Math.max(1,E)),B=n["Damage dealt"]||0,I=B/Math.max(1,m-(g+u+f)),C=0,L=0;if(t||l||r||a){let w=r+calculateXPSum(t),P=a+calculateXPSum(l);C=(L=P-w)/Math.max(1,m)}let A=n["Free for all kills"]||0,k=n["Infecteds killed"]||0,q=n.Infections||0,T=13/Math.max(1,m)*($*(9*A+15*k+40*y+25*q+100*f)+15*b*v),D=(2*m*(86*_+32*$*I)+59*o*L)/(165*m);e("op_result",26.45*Math.sqrt(D+T)),e("tp_result",D),e("sp_result",T),e("rg_result",E,0),e("gos_result",_),e("ad_result",I),e("xpr_result",C),updateFormattedStats(),graphVisible&&updateGraphs()}catch(X){console.error("Calculation error:",X),["op_result","tp_result","sp_result","rg_result","gos_result","ad_result","xpr_result"].forEach(e=>{let t=document.getElementById(e);t.textContent="-",t.classList.add("error"),t.setAttribute("title",X.message||"Invalid calculation")}),document.getElementById("formattedStats").textContent="Calculating...",showErrorPopup("Calculation error: "+(X.message||"Invalid calculation")),updateGraphs()}}function cleanText(e){let t=new Map;return e.split("\n").forEach(e=>{let r=e.match(/([a-zA-Z\s]+)[:\s]+([0-9,\.]+)/);if(r){let[l,a,o]=r,s=a.trim().toLowerCase(),n=o.replace(/[^\d]/g,"");t.set(s,n)}}),0===t.size&&e.split("\n").forEach(e=>{let r=e.match(/([a-zA-Z\s]+)\s*(\d[\d,\.]*)/);if(r){let[l,a,o]=r,s=a.trim().toLowerCase(),n=o.replace(/[^\d]/g,"");t.set(s,n)}}),FIXED_LABELS.map(e=>{let r=t.get(e.toLowerCase())||"0";return`${e}: ${r}`}).join("\n")}function addExperienceInputListeners(){["l_va","X_pa","l_vb","X_pb","sdi"].forEach(e=>{document.getElementById(e).addEventListener("input",()=>{validateNumericInputs(e),calculateOP()}),document.getElementById(e).addEventListener("keypress",e=>{let t=String.fromCharCode(e.which);/[0-9.\-]/.test(t)||(e.preventDefault(),showErrorPopup("Please enter only numeric values."))})})}function calculateXPSum(e){let t=0;for(let r=1;r<=e;r++)t+=10*Math.floor((r-1)*(2.46*Math.pow(1.02,r))*10);return t}function validateExperienceInputs(){parseFloat(document.getElementById("l_va").value),parseFloat(document.getElementById("l_vb").value),document.getElementById("l_vb").classList.remove("error"),document.getElementById("l_vb").removeAttribute("title")}function validateNumericInputs(e){let t=document.getElementById(e),r=parseFloat(t.value);isNaN(r)?(t.classList.add("error"),t.setAttribute("title","Please enter only numeric values.")):(t.classList.remove("error"),t.removeAttribute("title"))}function validateNumericStatInputs(e){let t=parseInt(e.textContent);isNaN(t)?(e.classList.add("error"),e.setAttribute("title","Please enter only numeric values.")):(e.classList.remove("error"),e.removeAttribute("title"))}function validateStatInputs(){let e=document.querySelector("#output .stat-label:nth-of-type(2)"),t=document.querySelector("#output .stat-label:nth-of-type(3)");e&&parseInt(e.parentElement.querySelector(".stat-value").textContent),t&&parseInt(t.parentElement.querySelector(".stat-value").textContent);let r={};document.querySelectorAll("#output .stat-line").forEach(e=>{let t=e.querySelector(".stat-label").textContent,l=parseInt(e.querySelector(".stat-value").textContent)||0;r[t]=l}),r["Targets assassinated"]<r.Escapes?(showErrorPopup("Targets assassinated cannot be lower than Escapes."),document.querySelectorAll("#output .stat-line").forEach(e=>{let t=e.querySelector(".stat-label").textContent;("Targets assassinated"===t||"Escapes"===t)&&(e.querySelector(".stat-value").classList.add("error"),e.querySelector(".stat-value").setAttribute("title","Cannot be lower than Escapes."))})):document.querySelectorAll("#output .stat-line").forEach(e=>{let t=e.querySelector(".stat-label").textContent;("Targets assassinated"===t||"Escapes"===t)&&(e.querySelector(".stat-value").classList.remove("error"),e.querySelector(".stat-value").removeAttribute("title"))})}function calculateOP(){try{let e=(e,t,r=3)=>{let l=document.getElementById(e);try{if(isNaN(t)||!isFinite(t)){l.textContent="-";return}l.textContent=0===r?Math.round(t):t.toFixed(r),l.classList.remove("error"),l.removeAttribute("title")}catch(a){l.textContent="-",l.classList.add("error"),l.setAttribute("title",a.message),showErrorPopup("Calculation error: "+a.message)}},t=parseFloat(document.getElementById("l_va").value)||0,r=parseFloat(document.getElementById("X_pa").value)||0,l=parseFloat(document.getElementById("l_vb").value)||0,a=parseFloat(document.getElementById("X_pb").value)||0,o=parseFloat(document.getElementById("sdi").value)||1,s=autoPenaltyCheckbox.checked,n={};document.querySelectorAll("#output .stat-line").forEach(e=>{let t=e.querySelector(".stat-label").textContent,r=parseInt(e.querySelector(".stat-value").textContent)||0;n[t]=r});let i=n["Rounds played"]||0,c=n["Targets assassinated"]||0,u=n["Target survivals"]||0,d=!1,p=i;if(s&&i>0){let h=(c+u)/i<.12;h&&(p=i+3*(.12*i-(c+u)),p=Math.floor(p),d=!0)}document.getElementById("round_penalty_applied").textContent=d?"Yes":"No",document.getElementById("round_penalty_value").textContent=d?p:"-",d&&(i=p);let g=n.Escapes||0,m=i-g,v=n["Infection survivals"]||0,y=n["Free for all wins"]||0,f=n.Epidemics||0,E=Math.max(0,m-g-u-f-v-y),b=o<1?1+(2/3*(o-1)+1)-1:2/3*(o-1)+1,$=o<1?1+(4/3*(o-1)+1)-1:4/3*(o-1)+1,x=n["Final shots"]||0,S=n["Targets protected"]||0,_=46*((5*o*x+3*b*S)/Math.max(1,E)),B=n["Damage dealt"]||0,I=B/Math.max(1,m-(g+u+f)),C=0,L=0;if(t||l||r||a){let w=r+calculateXPSum(t),P=a+calculateXPSum(l);C=(L=P-w)/Math.max(1,m)}let A=n["Free for all kills"]||0,k=n["Infecteds killed"]||0,q=n.Infections||0,T=13/Math.max(1,m)*($*(9*A+15*k+40*y+25*q+100*f)+15*b*v),D=(2*m*(86*_+32*$*I)+59*o*L)/(165*m);e("op_result",26.45*Math.sqrt(D+T)),e("tp_result",D),e("sp_result",T),e("rg_result",E,0),e("gos_result",_),e("ad_result",I),e("xpr_result",C),updateFormattedStats(),graphVisible&&updateGraphs()}catch(X){console.error("Calculation error:",X),["op_result","tp_result","sp_result","rg_result","gos_result","ad_result","xpr_result"].forEach(e=>{let t=document.getElementById(e);t.textContent="-",t.classList.add("error"),t.setAttribute("title",X.message||"Invalid calculation")}),document.getElementById("formattedStats").textContent="Calculating...",showErrorPopup("Calculation error: "+(X.message||"Invalid calculation")),updateGraphs()}}function updateFormattedStats(){let e=parseFloat(document.getElementById("op_result").textContent)||0,t=parseFloat(document.getElementById("tp_result").textContent)||0,r=parseFloat(document.getElementById("sp_result").textContent)||0,l=parseFloat(document.getElementById("gos_result").textContent)||0,a=parseFloat(document.getElementById("ad_result").textContent)||0,o=parseFloat(document.getElementById("xpr_result").textContent)||0,s=parseFloat(document.getElementById("sdi").value)||1,n=document.querySelector(".device-option.selected")?document.querySelector(".device-option.selected").getAttribute("data-value"):"pc",i=e;"mobile"===n&&(i*=1.075),"tablet"===n&&(i*=1.05),"console"===n&&(i*=1.1);let c="";c=i>=975?"Kugelblitz (S)":i>=935?"Radiance (A+)":i>=870?"Firestorm (A)":i>=820?"Flashover (A-)":i>=765?"Magnesium (B+)":i>=705?"Thermite (B)":i>=635?"Propane (C)":i>=560?"Wood (D)":"Ember (E)";let u=`OP = ${Math.round(i)}
TP = ${Math.round(t)}, SP = ${Math.round(r)}
[GO = ${Math.round(l)}], [AD = ${Math.round(a)}], [XPR = ${Math.round(o)}]
SDI = ${s.toFixed(4)}

Division: ${c}
Source: website`;document.getElementById("formattedStats").textContent=u}window.addEventListener("DOMContentLoaded",()=>{autoPenaltyCheckbox.checked=!0,calculateOP()}),window.addEventListener("load",()=>{let e=document.querySelector(".stat-value");e&&(e.focus(),setCaretAtEnd(e));let t=localStorage.getItem("selectedDevice")||"pc",r=document.querySelector(`button[data-value="${t}"]`);if(r&&r.classList.add("selected"),calculateOP(),copyButton.disabled=!1,addExperienceInputListeners(),!output.innerHTML){let l=FIXED_LABELS.map(e=>`
                    <div class="stat-line">
                        <span class="stat-label">${e}</span>
                        <span class="stat-value" contenteditable="true"></span>
                    </div>
                `).join("");output.innerHTML=l,document.querySelectorAll(".stat-value").forEach(e=>{e.addEventListener("input",()=>{validateStatInputs(),validateNumericStatInputs(e),calculateOP()}),e.addEventListener("keypress",e=>{let t=String.fromCharCode(e.which);/[0-9]/.test(t)||(e.preventDefault(),showErrorPopup("Please enter only numeric values."))})}),output.addEventListener("keydown",e=>{if(e.target.classList.contains("stat-value")){let t=e.target.closest(".stat-line");if("ArrowDown"===e.key){if(e.preventDefault(),t.nextElementSibling){let r=t.nextElementSibling.querySelector(".stat-value");r&&(r.focus(),setCaretAtEnd(r))}else document.getElementById("l_va").focus(),document.getElementById("l_va").select()}if("ArrowUp"===e.key&&(e.preventDefault(),t.previousElementSibling)){let l=t.previousElementSibling.querySelector(".stat-value");l&&(l.focus(),setCaretAtEnd(l))}}}),document.addEventListener("keydown",function(e){if("l_va"===e.target.id&&("ArrowUp"===e.key||"ArrowLeft"===e.key)){e.preventDefault();let t=document.querySelector(".stat-line:last-child .stat-value");t&&(t.focus(),setCaretAtEnd(t))}let r=["l_va","X_pa","l_vb","X_pb","sdi"],l=r.indexOf(e.target.id);if(-1!==l){if("ArrowRight"===e.key){if(e.preventDefault(),l<r.length-1)document.getElementById(r[l+1]).focus(),document.getElementById(r[l+1]).select();else if(l===r.length-1){let a=document.querySelector(".device-option");a&&a.focus()}}else"ArrowLeft"===e.key&&(e.preventDefault(),l>0&&(document.getElementById(r[l-1]).focus(),document.getElementById(r[l-1]).select()))}})}autoPenaltyCheckbox.addEventListener("change",()=>{calculateOP()}),document.getElementById("showTutorial").addEventListener("click",()=>{localStorage.removeItem("tutorialComplete"),new Tutorial(tutorialSteps)}),closeError.addEventListener("click",()=>{hideErrorPopup()}),errorPopup.addEventListener("click",e=>{e.target===errorPopup&&hideErrorPopup()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&errorPopup.classList.contains("active")&&hideErrorPopup()}),window.addEventListener("scroll",()=>{window.scrollY>300?(scrollUpButton.classList.add("show"),scrollUpButton.classList.remove("hide")):(scrollUpButton.classList.add("hide"),scrollUpButton.classList.remove("show"))}),scrollUpButton.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),toggleGraphButton.addEventListener("click",()=>{let e=document.querySelector(".graphs-section");graphVisible?(e.classList.remove("show"),toggleGraphButton.innerHTML='<i class="fas fa-chart-pie"></i> Show Graph',graphVisible=!1):(e.classList.add("show"),toggleGraphButton.innerHTML='<i class="fas fa-chart-pie"></i> Hide Graph',graphVisible=!0,e.scrollIntoView({behavior:"smooth",block:"center"}),updateGraphs())});let a=["l_va","X_pa","l_vb","X_pb","sdi"];a.forEach(e=>{let t=document.getElementById(e);t&&t.addEventListener("keydown",e=>{("ArrowUp"===e.key||"ArrowDown"===e.key)&&e.preventDefault()})})}),output.addEventListener("input",e=>{if(e.target.classList.contains("stat-value")){validateStatInputs();let t=e.target.textContent;t&&!/^\d+$/.test(t)?(e.target.classList.add("error"),e.target.setAttribute("title","Please enter only numbers"),showErrorPopup("Please enter only numeric values.")):(e.target.classList.remove("error"),e.target.removeAttribute("title")),calculateOP()}}),resetButton.addEventListener("click",()=>{document.querySelectorAll(".stat-value").forEach(e=>{e.textContent=(e.closest(".stat-line").querySelector(".stat-label").textContent,""),e.classList.remove("error"),e.removeAttribute("title")}),["l_va","X_pa","l_vb","X_pb"].forEach(e=>{document.getElementById(e).value="",document.getElementById(e).classList.remove("error"),document.getElementById(e).removeAttribute("title")}),document.getElementById("sdi").value="1",document.getElementById("sdi").classList.remove("error"),document.getElementById("sdi").removeAttribute("title"),autoPenaltyCheckbox.checked=!0;let e=localStorage.getItem("selectedDevice")||"pc";document.querySelectorAll(".device-option").forEach(e=>e.classList.remove("selected"));let t=document.querySelector(`button[data-value="${e}"]`);t&&t.classList.add("selected"),graphVisible&&(toggleGraphButton.innerHTML='<i class="fas fa-chart-pie"></i> Show Graph',graphVisible=!1,document.querySelector(".graphs-section").classList.remove("show")),document.getElementById("round_penalty_applied").textContent="No",document.getElementById("round_penalty_value").textContent="-",calculateOP()}),copyButton.addEventListener("click",()=>{let e=Array.from(output.querySelectorAll(".stat-line")).map(e=>{let t=e.querySelector(".stat-label").textContent,r=e.querySelector(".stat-value").textContent.replace(/[^\d]/g,"");return`${t} ${r}`}).join("\n");navigator.clipboard.writeText(e).then(()=>{copyButton.innerHTML='<i class="fas fa-check"></i> Copied!',setTimeout(()=>{copyButton.innerHTML='<i class="fas fa-copy"></i> Copy'},2e3)},e=>{console.error("Error copying text: ",e),showErrorPopup("Failed to copy to clipboard.")})}),document.querySelectorAll(".device-option").forEach(e=>{e.addEventListener("click",function(){document.querySelectorAll(".device-option").forEach(e=>e.classList.remove("selected")),this.classList.add("selected");let e=this.getAttribute("data-value");localStorage.setItem("selectedDevice",e),calculateOP()}),e.addEventListener("keydown",function(e){if("ArrowRight"===e.key){e.preventDefault();let t=this.nextElementSibling;t?t.focus():this.parentElement.firstElementChild.focus()}else if("ArrowLeft"===e.key){e.preventDefault();let r=this.previousElementSibling;r?r.focus():this.parentElement.lastElementChild.focus()}})});const existingCalculateOP=calculateOP;function updateStatVisibility(){document.querySelectorAll(".stat-line").forEach(e=>{let t=e.querySelector(".stat-value").textContent;t&&""!==t.trim()?e.classList.add("has-value"):e.classList.remove("has-value")})}calculateOP=function(){existingCalculateOP(),updateFormattedStats()},document.getElementById("copyFormatted").addEventListener("click",function(){let e=document.getElementById("formattedStats").textContent;navigator.clipboard.writeText(e).then(()=>{this.innerHTML='<i class="fas fa-check"></i> Copied!',setTimeout(()=>{this.innerHTML='<i class="fas fa-copy"></i> Copy'},2e3)}).catch(()=>{showErrorPopup("Failed to copy formatted stats.")})});const tutorialSteps=[{target:".stat-line:first-child",content:"Start by entering your game statistics. The first field is for Rounds played.",position:"right"},{target:"#l_va",content:"Enter your starting level (Level A) here.",position:"right"},{target:"#X_pa",content:"Input your starting XP (XP A) here.",position:"right"},{target:".device-options",content:"Select your gaming device to get accurate performance calculations with platform bonuses.",position:"right"},{target:".results-section",content:"Your performance stats will appear here. The Overall Performance (OP) determines your division ranking.",position:"left"},{target:"#formattedStats",content:"Find your complete stats summary here, ready to copy and share.",position:"right"},{target:".graphs-section",content:"View your performance through an interactive graph to better understand your stats.",position:"bottom"}];class Tutorial{constructor(e){this.steps=e,this.currentStep=0,this.overlay=null,this.box=null,this.init()}init(){"true"!==localStorage.getItem("tutorialComplete")&&(this.createOverlay(),this.showStep(0))}createOverlay(){this.overlay=document.createElement("div"),this.overlay.className="tutorial-overlay",document.body.appendChild(this.overlay),this.overlay.style.display="block"}showStep(e){let t=this.steps[e],r=document.querySelector(t.target);if(!r){console.error(`Tutorial target not found: ${t.target}`),this.complete();return}this.box?(this.box.style.opacity="0",setTimeout(()=>{this.box.remove(),this.createNewBox(t,r)},300)):this.createNewBox(t,r),document.querySelectorAll(".highlight-element").forEach(e=>{e.classList.remove("highlight-element")}),r.classList.add("highlight-element");let l=window.innerHeight/3,a=r.getBoundingClientRect().top+window.pageYOffset-l;window.scrollTo({top:a,behavior:"smooth"})}createNewBox(e,t){this.box=document.createElement("div"),this.box.className="tutorial-box",this.box.style.opacity="0",this.box.innerHTML=`
                    <div>${e.content}</div>
                    <div class="tutorial-buttons" style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end;">
                        ${this.currentStep>0?'<button class="tutorial-prev" title="Previous"><i class="fas fa-arrow-left"></i></button>':""}
                        ${this.currentStep<this.steps.length-1?'<button class="tutorial-next" title="Next"><i class="fas fa-arrow-right"></i></button>':'<button class="tutorial-complete" title="Complete"><i class="fas fa-check"></i></button>'}
                        <button class="tutorial-skip" title="Skip Tutorial">Skip</button>
                    </div>
                `,document.body.appendChild(this.box),this.positionBox(e,t),requestAnimationFrame(()=>{this.box.style.opacity="1"}),this.addButtonListeners()}positionBox(e,t){let r=t.getBoundingClientRect(),l=this.box.getBoundingClientRect(),a,o;switch(e.position){case"right":a=r.right+15,o=r.top,a+l.width>window.innerWidth-15&&(a=window.innerWidth-l.width-15);break;case"left":a=r.left-l.width-15,o=r.top;break;case"up":a=r.left,o=r.top-l.height-15;break;case"down":a=r.left,o=r.bottom+15;break;default:a=r.right+15,o=r.top}let s={left:20,right:window.innerWidth-20,top:20,bottom:window.innerHeight-20};a<s.left&&(a=s.left),a+l.width>s.right&&(a=s.right-l.width),o<s.top&&(o=s.top),o+l.height>s.bottom&&(o=s.bottom-l.height),this.box.style.transform="translate3d(0, 0, 0)",this.box.style.left=`${a}px`,this.box.style.top=`${o}px`}addButtonListeners(){let e=this.box.querySelector(".tutorial-prev"),t=this.box.querySelector(".tutorial-next"),r=this.box.querySelector(".tutorial-complete"),l=this.box.querySelector(".tutorial-skip");e&&e.addEventListener("click",()=>this.previousStep()),t&&t.addEventListener("click",()=>this.nextStep()),r&&r.addEventListener("click",()=>this.complete()),l&&l.addEventListener("click",()=>this.complete())}previousStep(){this.currentStep>0&&(document.querySelector(this.steps[this.currentStep].target).classList.remove("highlight-element"),this.currentStep--,this.showStep(this.currentStep))}nextStep(){this.currentStep<this.steps.length-1&&(document.querySelector(this.steps[this.currentStep].target).classList.remove("highlight-element"),this.currentStep++,this.showStep(this.currentStep))}complete(){localStorage.setItem("tutorialComplete","true"),this.box&&this.box.remove(),this.overlay&&this.overlay.remove(),document.querySelectorAll(".highlight-element").forEach(e=>e.classList.remove("highlight-element"))}}function showErrorPopup(e){errorMessage.textContent=e,errorPopup.classList.add("active")}function hideErrorPopup(){errorPopup.classList.remove("active")}function setCaretAtEnd(e){if(e.focus(),void 0!==window.getSelection&&void 0!==document.createRange){let t=document.createRange();t.selectNodeContents(e),t.collapse(!1);let r=window.getSelection();r.removeAllRanges(),r.addRange(t)}}function updateGraphs(){let e=parseFloat(document.getElementById("tp_result").textContent)||0,t=parseFloat(document.getElementById("sp_result").textContent)||0,r=parseFloat(document.getElementById("gos_result").textContent)||0,l=parseFloat(document.getElementById("ad_result").textContent)||0,a=parseFloat(document.getElementById("xpr_result").textContent)||0,o=document.getElementById("performanceChart").getContext("2d");performanceChart&&performanceChart.destroy(),performanceChart=new Chart(o,{type:"polarArea",data:{labels:["Tactical Performance (TP)","Special Performance (SP)","Guard Objective Score (GO)","Average Damage (AD)","XP per Round (XPR)"],datasets:[{data:[e,t,r,l,a],backgroundColor:["rgba(75, 192, 192, 0.6)","rgba(255, 99, 132, 0.6)","rgba(255, 206, 86, 0.6)","rgba(54, 162, 235, 0.6)","rgba(153, 102, 255, 0.6)"],borderColor:["rgba(75, 192, 192, 1)","rgba(255, 99, 132, 1)","rgba(255, 206, 86, 1)","rgba(54, 162, 235, 1)","rgba(153, 102, 255, 1)"],borderWidth:1,hoverOffset:4}]},options:{responsive:!0,plugins:{legend:{position:"right",labels:{color:"#72767d"}},tooltip:{enabled:!0,callbacks:{label:function(e){return`${e.label}: ${e.parsed}`}}}},scales:{r:{angleLines:{color:"#72767d"},grid:{color:"#72767d"},ticks:{color:"#72767d",backdropColor:"transparent"}}}}})}window.addEventListener("load",()=>{new Tutorial(tutorialSteps)});
    </script>
</body></html>
